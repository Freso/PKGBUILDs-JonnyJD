# Contributor: Wintershade (Wintershade (at) that-letter-before-H-mail (dot) com)
# Many thanks to Rasi for starting this

pkgname=rubyripper-git
pkgver=20100212
pkgrel=1

conflicts=('rubyripper')
replaces=('rubyripper')
provides=('rubyripper')

pkgdesc="Secure audiodisc ripper"
arch=('i686' 'x86_64')
url="http://code.google.com/p/rubyripper/"
license=('GPL3')

depends=('ruby' 'cdparanoia' 'gtk2' 'hicolor-icon-theme')
makedepends=('ruby-gettext' 'git')
optdepends=('ruby-gettext: Internationalization support'
	'ruby-gtk2: GTK+ GUI'
	'cd-discid: Freedb support'
	'eject: Eject support'
	'lame: MP3 encoding support'
	'vorbis-tools: Ogg Vorbis encoding support'
	'flac: FLAC encoding support'
	'wavegain: WAV ReplayGain support'
	'mp3gain: MP3 ReplayGain support'
	'vorbisgain: Ogg Vorbis ReplayGain support'
	'normalize: Normalization support')
install=rubyripper.install
source=()

_gitroot="git://github.com/rubyripperdev/rubyripper.git"
#_gitroot="git://github.com/JonnyJD/rubyripper.git"
_gitname="rubyripper"


build() {
cd $startdir/src
msg "Connecting to rubyripper git server..."

if [ -d $startdir/src/$_gitname ] ; then
	cd $_gitname && git pull origin
	msg "The local files are updated."
	#git revert --no-edit 9eb44c04f95
	#patch -p1 < ../../ru_utf_error.patch
else
	git clone $_gitroot
	cd $_gitname
	echo "reseting.."
	#git reset --hard c678c6d69d4d 
	#git reset --hard cb2e249bf 
	#git reset --hard 22d806408cb 
	#git reset --hard a5848a38cdd52 
	#git reset --hard a709f048e 
	#git reset --hard 2439e46ce32 
	#git reset --hard 0d36541e30 
	#git reset --hard 88f91a3482ac 
	#git reset --hard 9eb44c04f95 # russian (fails)
	#git reset --hard 047d345781 # german (works)
	# ----- my fork
	#git reset --hard 9eb44c04f95 # russian (fails)
	#git reset --hard 047d345781 # german (works)
	#git reset --hard da0917249 # branch (works)

	echo "reverting.."
	#git revert --no-edit cb2e249bf # timeout
	#git revert --no-edit a5848a38cdd # --all option
	#git revert --no-edit 9eb44c04f95 # russian

	#echo "patching.."
	#patch -p1 < ../../ru_utf_error.patch
	#head -n 521 locale/po/ru/rubyripper.po > tmp.$$
	#mv tmp.$$ locale/po/ru/rubyripper.po
fi

cd "$srcdir/rubyripper"
#rm -r locale/po/{bg,fr}
#rm -r locale/po/{ru,bg}
#rm -r locale/po/bg
#./configure --udpate-lang
./configure --prefix=/usr --enable-gtk2 --enable-cli --enable-lang-all
#./configure --prefix=/usr --enable-gtk2 --enable-cli
#./configure --enable-gtk2 --enable-cli --enable-lang-all
#./configure --enable-gtk2 --enable-cli
#cat configure | sed -e '/update_pofiles/d' > configure.$$
#mv configure.$$ configure
make DESTDIR="$pkgdir" install
#LC_ALL=en_US.UTF-8 make DESTDIR="$pkgdir" install

exit 1
}
